<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>View Property Violation Notices here</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      background-color: #f4f6f9;
      padding: 20px;
    }

    .container {
      max-width: 800px;
      margin: auto;
      background: white;
      padding: 30px;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }

    h1, h2 {
      color: #333;
    }

    .section {
      margin-bottom: 25px;
    }

    .section h2 {
      margin-bottom: 10px;
      border-bottom: 2px solid #007BFF;
      padding-bottom: 5px;
    }

    .details p, .violation-item {
      margin: 6px 0;
      color: #555;
    }

    .violation-dropdown {
      margin: 15px 0;
    }

    .violation-dropdown label {
      display: block;
      margin-bottom: 8px;
      font-weight: bold;
      color: #333;
    }

    .violation-dropdown select {
      width: 100%;
      padding: 10px;
      border: 2px solid #ddd;
      border-radius: 6px;
      font-size: 16px;
      background-color: white;
    }

    .violation-dropdown select:focus {
      border-color: #007BFF;
      outline: none;
    }

    .notice-links {
      margin-top: 20px;
    }

    .notice-links a {
      display: inline-block;
      margin: 10px 8px 0 0;
      background-color: #007BFF;
      color: white;
      padding: 12px 18px;
      border-radius: 6px;
      text-decoration: none;
      font-weight: bold;
      transition: all 0.3s ease;
      opacity: 0.7;
      pointer-events: none;
    }

    .notice-links a.active {
      opacity: 1;
      pointer-events: auto;
    }

    .notice-links a.active:hover {
      background-color: #0056b3;
      transform: translateY(-2px);
    }

    .violation-list {
      padding-left: 20px;
    }

    .violation-detected {
      background-color: #fff3cd;
      border: 1px solid #ffeaa7;
      padding: 10px;
      border-radius: 6px;
      margin: 10px 0;
      color: #856404;
    }

    .no-violations {
      background-color: #d4edda;
      border: 1px solid #c3e6cb;
      padding: 10px;
      border-radius: 6px;
      margin: 10px 0;
      color: #155724;
    }

    .footer {
      text-align: center;
      margin-top: 40px;
      font-size: 0.9em;
      color: #999;
    }

    .violation-info {
      background-color: #e7f3ff;
      border-left: 4px solid #007BFF;
      padding: 15px;
      margin: 15px 0;
      border-radius: 0 6px 6px 0;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Property Violation Notice System</h1>

    <!-- Section: Property Info -->
    <div class="section details">
      <h2>Property Details</h2>
      <p><strong>Owner:</strong> <span id="owner"></span></p>
       <p><strong>Property Id:T</strong> <span id="id"></span></p>
    </div>

    <!-- Section: Violation Detection -->
    <div class="section">
      <h2>Violation Status</h2>
      <div id="violationStatus"></div>
    </div>

    <!-- Section: Manual Violation Selection -->
    <div class="section">
      <h2>Manual Violation Selection</h2>
      <div class="violation-dropdown">
        <label for="violationType">Select Violation Type:</label>
        <select id="violationType">
          <option value="">-- Select a Violation --</option>
          <option value="occupancy">Occupancy Change Notice</option>
          <option value="area">Area Change Notice</option>
          <option value="unauthorized">Unauthorized Construction Notice</option>
          <option value="owner">Owner Change Notice (Jama Mattam)</option>
          <option value="general">General Notice to Building Owners</option>
        </select>
      </div>
      
      <div class="violation-info">
        <p><strong>Instructions:</strong> Select a violation type from the dropdown above to generate the appropriate notice. The system will automatically detect certain violations based on property data, but you can also manually select any violation type.</p>
      </div>
    </div>

    <!-- Section: Generate Notices -->
    <div class="section">
      <h2>Generate Violation Notices</h2>
      <div class="notice-links">
        <a href="#" id="occupancyNotice">üìã Occupancy Change Notice</a>
        <a href="#" id="areaNotice">üìê Area Change Notice</a>
        <a href="#" id="unauthorizedNotice">üèóÔ∏è Unauthorized Construction Notice</a>
        <a href="#" id="ownerNotice">üë§ Owner Change Notice</a>
        <a href="#" id="generalNotice">üìÑ General Notice</a>
      </div>
    </div>

    <div class="footer">
      Notice generated by Urban Local Body System | ¬© 2025
    </div>
  </div>

  <script>
    // Parse query string parameters
    const params = new URLSearchParams(window.location.search);

    // Populate property details
    document.getElementById("owner").textContent = params.get("owner") || "N/A";
    document.getElementById("id").textContent = params.get("id") || "N/A";
    
    // Get violation-related parameters from your arcade expression
    const areaChange = parseFloat(params.get("areachange")) || 0; // Note: lowercase 'areachange' from your URL
    const propertyId = params.get("id") || "";
    const dueAmount = params.get("due") || "";
    
    // Additional violation detection logic
    const ownerChange = params.get("ownerchange") === "true" || params.get("ownr_change") === "true";
    const occupancyChange = params.get("occupancychange") === "true" || params.get("usage_change") === "true";
    const unauthorizedConstruction = params.get("unauthorized") === "true" || params.get("unauth_const") === "true";

    // Define notice URLs with property parameters passed through
    const noticeUrls = {
      occupancy: `https://ulgissctl.github.io/demandnotice/occupancychange.html?id=${propertyId}&owner=${encodeURIComponent(params.get("owner") || "")}&ward=${encodeURIComponent(params.get("ward") || "")}`,
      area: `https://ulgissctl.github.io/demandnotice/structuralchangeNotice.html?id=${propertyId}&owner=${encodeURIComponent(params.get("owner") || "")}&areachange=${areaChange}&ward=${encodeURIComponent(params.get("ward") || "")}`,
      unauthorized: `https://ulgissctl.github.io/demandnotice/unauthorizedconstruction_noticeEngineeringSection.html?id=${propertyId}&owner=${encodeURIComponent(params.get("owner") || "")}&ward=${encodeURIComponent(params.get("ward") || "")}`,
      owner: `https://ulgissctl.github.io/demandnotice/namechange.html?id=${propertyId}&owner=${encodeURIComponent(params.get("owner") || "")}&ward=${encodeURIComponent(params.get("ward") || "")}`,
      general: `https://ulgissctl.github.io/demandnotice/notice.html?id=${propertyId}&owner=${encodeURIComponent(params.get("owner") || "")}&due=${dueAmount}&ward=${encodeURIComponent(params.get("ward") || "")}`
    };

    // Detect violations automatically based on your arcade parameters
    const detectedViolations = [];
    
    // Area change violation - based on your areachng field
    if (areaChange !== 0) {
      const changeType = areaChange > 0 ? "increase" : "decrease";
      const changeAmount = Math.abs(areaChange);
      detectedViolations.push({
        type: "area",
        description: `Area change violation: ${changeAmount} sq.m ${changeType} detected (Property ID:T${propertyId})`
      });
    }

    // Owner change violation
    if (ownerChange) {
      detectedViolations.push({
        type: "owner",
        description: "Ownership change detected - Jama Mattam notice required"
      });
    }

    // Occupancy change violation
    if (occupancyChange) {
      detectedViolations.push({
        type: "occupancy",
        description: "Building occupancy/usage change detected"
      });
    }

    // Unauthorized construction violation
    if (unauthorizedConstruction) {
      detectedViolations.push({
        type: "unauthorized",
        description: "Unauthorized construction activities detected"
      });
    }

    // Additional logic: Check if due amount suggests violations
    if (dueAmount && parseFloat(dueAmount) > 0) {
      // This could indicate pending tax due to violations
      detectedViolations.push({
        type: "general",
        description: `Outstanding dues detected: ‚Çπ${dueAmount} - General notice may be required`
      });
    }

    // Display violation status
    const violationStatus = document.getElementById("violationStatus");
    
    if (detectedViolations.length > 0) {
      violationStatus.innerHTML = `
        <div class="violation-detected">
          <strong>‚ö†Ô∏è Violations Detected (${detectedViolations.length}):</strong>
          <ul style="margin: 10px 0 0 20px;">
            ${detectedViolations.map(v => `<li>${v.description}</li>`).join('')}
          </ul>
        </div>
      `;
      
      // Enable corresponding notice links
      detectedViolations.forEach(violation => {
        const linkId = violation.type + "Notice";
        const linkElement = document.getElementById(linkId);
        if (linkElement) {
          linkElement.classList.add("active");
          linkElement.href = noticeUrls[violation.type];
        }
      });
    } else {
      violationStatus.innerHTML = `
        <div class="no-violations">
          <strong>‚úÖ No automatic violations detected</strong>
          <p>Use the dropdown below to manually select and generate violation notices if needed.</p>
        </div>
      `;
    }

    // Handle manual violation selection
    const violationTypeSelect = document.getElementById("violationType");
    const allNoticeLinks = document.querySelectorAll(".notice-links a");

    violationTypeSelect.addEventListener("change", function() {
      const selectedType = this.value;
      
      // Reset all links to inactive state
      allNoticeLinks.forEach(link => {
        link.classList.remove("active");
        link.href = "#";
      });
      
      // Activate selected violation link
      if (selectedType && noticeUrls[selectedType]) {
        const linkId = selectedType + "Notice";
        const selectedLink = document.getElementById(linkId);
        if (selectedLink) {
          selectedLink.classList.add("active");
          selectedLink.href = noticeUrls[selectedType];
        }
      }
      
      // Keep auto-detected violations active
      detectedViolations.forEach(violation => {
        const linkId = violation.type + "Notice";
        const linkElement = document.getElementById(linkId);
        if (linkElement) {
          linkElement.classList.add("active");
          linkElement.href = noticeUrls[violation.type];
        }
      });
    });

    // Initialize with detected violations
    detectedViolations.forEach(violation => {
      const linkId = violation.type + "Notice";
      const linkElement = document.getElementById(linkId);
      if (linkElement) {
        linkElement.classList.add("active");
        linkElement.href = noticeUrls[violation.type];
      }
    });
  </script>
</body>
</html>
